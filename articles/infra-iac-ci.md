---
title: "IaC ã®å“è³ªã‚‚è‡ªå‹•ã§ç®¡ç†ã™ã‚‹æ™‚ä»£: pre-commit ã¨é™çš„è§£æãƒ„ãƒ¼ãƒ«ã®å°å…¥ã®ã‚¹ã‚¹ãƒ¡"
yaml_title: infra-iac-ci
created: 2024-09-06 16:45:05
updated: 2024-09-13 17:41:32
tags: 
aliases: 
emoji: ğŸ·
published: true
published_at: 2024-09-17 09:00
topics:
  - Terraform
  - github
  - security
type: tech
---
# ã¯ã˜ã‚ã«

ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚³ãƒ¼ãƒ‰ï¼ˆIaCï¼‰ã®å“è³ªãŒã€**ä½œæˆè€…ã«ã‚ˆã£ã¦å¤§ãããƒãƒ©ã¤ã„ã¦ã—ã¾ã†**ã“ã¨ãŒã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ

æ‰‹ä½œæ¥­ã«é ¼ã‚‰ãšã«ã€IaCï¼ˆä¸»ã« Terraformï¼‰ã®å“è³ªã‚’è‡ªå‹•çš„ã«ä¿è¨¼ã™ã‚‹æ–¹æ³•ãŒã‚ã‚Œã°ã€ãƒŸã‚¹ã‚’æ¸›ã‚‰ã—ã€ã‚ˆã‚Šä¸€è²«ã—ãŸã‚³ãƒ¼ãƒ‰å“è³ªã‚’ä¿ã¦ã‚‹ã§ã—ã‚‡ã†ã€‚

ãã“ã§ä»Šå›ã¯ã€**pre-commit** ã‚’åˆ©ç”¨ã—ã¦è¤‡æ•°ã®é™çš„è§£æãƒ„ãƒ¼ãƒ«ã‚’è‡ªå‹•ã§å®Ÿè¡Œã—ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è„†å¼±æ€§ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ä»•çµ„ã¿ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

https://pre-commit.com/

ã“ã®ä»•çµ„ã¿ã«ã‚ˆã‚Šã€ã‚³ãƒŸãƒƒãƒˆæ™‚ã«å•é¡ŒãŒæ¤œå‡ºã•ã‚Œã‚‹ã¨ã‚³ãƒŸãƒƒãƒˆãŒå¤±æ•—ã™ã‚‹ãŸã‚ã€ä¸€å®šã®å“è³ªãŒä¿è¨¼ã•ã‚Œã¾ã™ã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€å°å…¥ã—ãŸä»•çµ„ã¿ã®è©³ç´°ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

# ä½¿ç”¨ã—ãŸãƒ„ãƒ¼ãƒ«ä¸€è¦§

ä»Šå›ã®å°å…¥ã§ä½¿ç”¨ã—ãŸãƒ„ãƒ¼ãƒ«ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™.

- **pre-commit** - ã‚³ãƒ¼ãƒ‰ã®ã‚³ãƒŸãƒƒãƒˆæ™‚ã«ãƒ•ãƒƒã‚¯ã‚’è¨­å®šã—ã¦è‡ªå‹•çš„ã«è§£æã‚’å®Ÿè¡Œã€‚
- **OpenTofu** - Terraform ã¨äº’æ›æ€§ã‚ã‚Šã€ä¸»ã« OpenTofu ãƒ™ãƒ¼ã‚¹ã®ç’°å¢ƒã§åˆ©ç”¨ã€‚
- **TFLint** - Terraform ç”¨ã® Linter ã§æ§‹æˆã‚„ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã€‚
- **Checkov** - IaC ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã‚’è¡Œã†é™çš„è§£æãƒ„ãƒ¼ãƒ«ã€‚
- **terraform-docs** - Terraform ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è‡ªå‹•ç”Ÿæˆã€‚

:::message

ãªãŠã€ã“ã®è¨˜äº‹ã§ã¯ OpenTofu ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€Terraform ç’°å¢ƒã§ã‚‚åŒæ§˜ã®è¨­å®šãŒå¯èƒ½ã§ã™ã€‚Terraform ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€"tofu" ã‚’ "terraform" ã¨èª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚

:::

# Pre-commit ã®å°å…¥æ‰‹é †

## 1. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

ã¾ãšã¯ã€pre-commit ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚ä»¥ä¸‹ãŒè¨­å®šã®ä¾‹ã§ã™ã€‚

```yaml
repos:
- repo: https://github.com/tofuutils/pre-commit-opentofu
  rev: v1.0.2 # Get the latest from: https://github.com/tofuutils/pre-commit-opentofu/releases
  hooks:
  - id: tofu_fmt
  - id: tofu_validate
  - id: tofu_tflint
  - id: tofu_checkov
    args:
    - --args=--config-file __GIT_WORKING_DIR__/.checkov.yaml
  - id: tofu_docs
    args:
    - --hook-config=--path-to-file=README.md
    - --hook-config=--add-to-existing-file=true
    - --hook-config=--create-file-if-not-exist=true
```

## 2. å„ãƒ„ãƒ¼ãƒ«ã®ãƒ•ãƒƒã‚¯ã®è©³ç´°

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§æŒ‡å®šã—ãŸå„ãƒ•ãƒƒã‚¯ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

- **tofu_fmt**  
    `tofu fmt` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€Terraform ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’æ•´ãˆã¾ã™ã€‚
    
- **tofu_validate**  
    `tofu validate` ã‚³ãƒãƒ³ãƒ‰ã§æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ãŒãªã„ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚
    
- **tofu_tflint**  
    `tflint` ã‚’å®Ÿè¡Œã—ã¦ã€æ§‹æ–‡ã®æ¤œè¨¼ã ã‘ã§ãªãã€è¨­å®šå€¤ã®å•é¡Œã‚‚ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚
    
- **tofu_checkov**  
    Checkov ã‚’åˆ©ç”¨ã—ã¦ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è„†å¼±æ€§ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚Checkov ã«é–¢ã™ã‚‹è©³ç´°ã¯ä¸‹è¨˜ã‚’ã”å‚ç…§ãã ã•ã„
	- https://zenn.dev/articles/feat-checkov
	    
- **tofu_docs**  
    Terraform ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã—ã€ãƒªã‚½ãƒ¼ã‚¹ã«é–¢ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆREADME.mdï¼‰ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚

> terraform ã®å ´åˆã¯ã“ã¡ã‚‰
> https://github.com/antonbabenko/pre-commit-terraform

## 3. Pre-commit ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

æ¬¡ã«ã€pre-commit ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦è¨­å®šã‚’åæ˜ ã•ã›ã¾ã™ã€‚

```shell
brew install pre-commit checkov tflint terraform-docs jq
pre-commit install
```

# ã“ã¡ã‚‰ã‚‚ãŠã™ã™ã‚

https://zenn.dev/yukionodera/articles/good-about-mise

https://zenn.dev/yukionodera/articles/datadog-asm-protection

https://zenn.dev/yukionodera/articles/how-to-manage-images-with-obsidiann

# ãŠã‚ã‚Šã«

pre-commit ã¨é™çš„è§£æãƒ„ãƒ¼ãƒ«ã‚’å°å…¥ã™ã‚‹ã“ã¨ã§ã€IaC ã«é–¢ã™ã‚‹å“è³ªã‚’è‡ªå‹•çš„ã«ãƒã‚§ãƒƒã‚¯ã—ã€ãƒªã‚¹ã‚¯ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚³ãƒ¼ãƒ‰ã®ä¸€è²«æ€§ã‚’ä¿ã¡ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚„ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã®å¼·åŒ–ã«ã‚‚ã¤ãªãŒã‚Šã¾ã™ã€‚

ä»Šå¾Œã‚‚ã€ã“ã®ä»•çµ„ã¿ã‚’æ´»ç”¨ã—ã¦ã€ã‚ˆã‚Šé«˜å“è³ªãª IaC ã‚³ãƒ¼ãƒ‰ã‚’ç®¡ç†ã—ã¦ã„ãã¾ã—ã‚‡ã†!
