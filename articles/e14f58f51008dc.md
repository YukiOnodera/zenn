---
title: kubernetes provider ã®è¨­å®šãŒåŸå› ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸ
created: 2023-12-13 19:18:29
updated: 2023-12-14 11:48:26
tags: 
aliases: 
emoji: ğŸ¤–
published: true
topics:
  - terraform
  - kubernetes
  - terragrunt
type: tech
---
# ã¯ã˜ã‚ã«

Terragrunt ã§ Plan ã—ãŸã‚‰ EKS å‘¨ã‚Šã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã‚ˆãã‚ã‹ã‚‰ãªã‹ã£ãŸã®ã§å¯¾å‡¦æ³•ã¾ã¨ã‚ã¾ã™ã€‚

# å•é¡Œ

ä¸‹è¨˜ã®ï¼’ä»¶ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

EKS ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å©ã„ã¦ã„ã‚‹ã¹ããªã®ã«ã€localhost ã«ãªã£ã¦ã„ã‚‹ã€ã€ï¼Ÿ

```shell
â•·
â”‚ Error: Get "http://localhost/api/v1/namespaces/aws-observability": dial tcp [::1]:80: connect: connection refused
â”‚
â”‚   with module.eks_blueprints_addons.kubernetes_namespace_v1.aws_observability[0],
â”‚   on .terraform/modules/eks_blueprints_addons/main.tf line 2545, in resource "kubernetes_namespace_v1" "aws_observability":
â”‚ 2545: resource "kubernetes_namespace_v1" "aws_observability" {
â”‚
â•µ
```
```shell
â”‚ Error: Get "http://localhost/api/v1/namespaces/aws-observability/configmaps/aws-logging": dial tcp [::1]:80: connect: connection refused
â”‚
â”‚   with module.eks_blueprints_addons.kubernetes_config_map_v1.aws_logging[0],
â”‚   on .terraform/modules/eks_blueprints_addons/main.tf line 2558, in resource "kubernetes_config_map_v1" "aws_logging":
â”‚ 2558: resource "kubernetes_config_map_v1" "aws_logging" {
â”‚
â•µ
```

å¯¾è±¡ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ state ã‹ã‚‰å‰Šé™¤ã—ãŸã‚‰ã€ã¨ã‚Šã‚ãˆãš Plan ã¯é€šã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ãŒã€Apply ã§çµå±€ä¼¼ãŸã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚

# è§£æ±ºæ–¹æ³•

provider ã®è¨­å®šã‚’è¦‹ç›´ã™ã¨ã„ã„ã¨æ€ã„ã¾ã™ã€‚(æœ€åˆã‹ã‚‰ã“ã£ã¡ã§è‰¯ã‹ã£ãŸ)

ä¸‹è¨˜ã¯ä¸€ä¾‹ã§ã™ã€‚

```hcl
provider "kubernetes" {
host = module.eks.cluster_endpoint
cluster_ca_certificate = base64decode(module.eks.cluster_certificate_authority_data)
exec {
api_version = "client.authentication.k8s.io/v1beta1"
args = ["eks", "get-token", "--cluster-name", module.eks.cluster_name]
command = "aws"
}
# config_path = "~/.kube/config"
# config_context = module.eks.cluster_arn
}
```
# ãŠã‚ã‚Šã«

ã‚¨ãƒ©ãƒ¼ã§æ¤œç´¢ã—ãŸã‚‰è‹±èªã® Discussion ã°ã£ã‹ã§ã¡ã‚‡ã£ã¨å¤§å¤‰ã ã£ãŸã€‚

ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸæ™‚ã«ã€ãªãœã‹ localhost ã«æ¥ç¶šã—ã¦ã„ã‚‹ã“ã¨ã«é•å’Œæ„Ÿã‚’æŒã£ã¦ã€ãã“ã‹ã‚‰ Provider ã®è¨­å®šã‚’ç–‘ã£ã¦ã„ã‚Œã°æ™‚é–“æµªè²»ã›ãšã«ã™ãã«å¯¾å‡¦ã§ããŸã‹ã‚‚ã€‚

# å‚è€ƒ

[Error: Get "http://localhost/api/v1/namespaces/kube-system/configmaps/aws-auth" Â· Issue #143 Â· cloudposse/terraform-aws-eks-cluster Â· GitHub](https://github.com/cloudposse/terraform-aws-eks-cluster/issues/143)

[Terraform Registry](https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs)

[2.6.0 provider version causing \`Error: Kubernetes cluster unreachable: exec plugin: invalid apiVersion\` Â· Issue #893 Â· hashicorp/terraform-provider-helm Â· GitHub](https://github.com/hashicorp/terraform-provider-helm/issues/893)
